# LuisDispatchBot hosted in ASP.NET Core

This bot demonstrates how to use a LUIS model generated by the [Dispatch tool](https://github.com/Microsoft/botbuilder-tools/tree/master/Dispatch).

See https://aka.ms/bot-dispatch for a tutorial that shows you how to set up this sample.

This example assumes the LUIS app from Dispatch is generated from two LUIS apps and one QnAMaker service:
 * A LUIS app named "homeautomation", for handling messages about turning lights and appliances on and off. For example, "turn on the lights" maps to the `HomeAutomation.TurnOn` intent.
 * A LUIS app named "weather", for handling requests for weather forecasts and conditions. For example, "get the weather forecast" maps to the `Weather.GetForecast` intent.
 * A QnA Maker service named "faq", for answering questions about using the hypothetical home automation system.
 
First create the LUIS apps and QnAMaker, then generate a LUIS app from them using the Dispatch tool.

1. Use the https://www.luis.ai portal to import the included homeautomation.json and weather.json model files or using [LUIS cli tool](https://github.com/Microsoft/botbuilder-tools/tree/master/LUIS).
2. Use the https://qnamaker.ai portal to import the included sampleKnowledgeBase.tsv faq file or using [QnAMaker cli tool](https://github.com/Microsoft/botbuilder-tools/tree/master/QnAMaker).
3. Train and publish your apps before using the Dispatch tool. (For your convenience the resulting dispatchSample.json LUIS model is also included).

The tool creates a LUIS app with one intent for each of the constituent LUIS apps and QnAMaker services: 
"l_homeautomation", "l_weather", "q_faq".
The bot uses the intents to route the user messages to the appropriate LUIS app or QnA Maker.

Dispatching the messages to the original LUIS apps allows the bot to get entities from the these apps. 
The LUIS app generated by the Dispatch tool doesn't contain entity information.

To use the sample, update the following fields in appsettings.json: 
* "Luis-SubscriptionKey": Your LUIS subscription key. This can be an endpoint key or an authoring key, described [here](https://docs.microsoft.com/en-us/azure/cognitive-services/luis/luis-concept-keys).
* "Luis-ModelId-Dispatcher": App ID for the LUIS app that the Dispatch tool generates. 
* "Luis-ModelId-HomeAutomation": App ID of the app you created from homeautomation.json
* "Luis-ModelId-Weather": App ID of the app you created from weather.json
* "QnAMaker-Endpoint-Url": This should be set to "https://westus.api.cognitive.microsoft.com/qnamaker/v2.0" for Preview QnA Maker services, and https://YOUR-QNA-SERVICE-NAME.azurewebsites.net/qnamaker for new (GA) QnA Maker services.
* "QnAMaker-SubscriptionKey": Your QnA Maker subscription key
* "QnQMaker-KnowledgeBaseId": The ID of the knowledge base you create at https://qnamaker.ai

